{% extends "base/base.html" %}
{% load markup %}

{% block title %}Task #{{ task.id }} | {{ task.name }}{% endblock %}

{% block body-class %}body-task{% endblock %}
{% block content-head-class %}head-dark{% endblock %}
{% block content-head %}
<a style="color: white;" title="Return Home" href="{% url 'home' %}">
    <div style="float: left;" class="col-md-1 text-center">
        <br/>
        <h3><span class="glyphicon glyphicon-chevron-left pull-right"></span></h3>
    </div>
</a>
<div class="container">
    <div class="row">
        <div class="col-md-9">
            <h4>Task #{{ task.id}}</h4>
            <h1>{{ task.name }}</h1>
            <span class="label label-default" style="background-color:#{{ task.triage.bg_colour }}; color:#{{ task.triage.fg_colour }}">{{ task.triage.name }}</span>
        </div>
        <div class="col-md-3">
            <div class="btn-group pull-right">
                <a class="btn btn-warning" href="{% url 'task:edit_task' task.id %}"><span class="glyphicon glyphicon-pencil"></span> Edit Task</a>
                {% if task.completed %}
                    <div class="btn-group pull-right">
                        <a class="btn btn-danger" href="#"><span class="glyphicon glyphicon-remove"></span></a>
                    </div>
                {% else %}
                    <div class="btn-group pull-right">
                        <a class="btn btn-success" href="{% url 'task:complete_task' task.id %}"><span class="glyphicon glyphicon-ok-circle"></span></a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <legend>Description</legend>
        <div class="panel panel-info">
            <div class="panel-body panel-description">
                {{ task.description|markup_markdown }}
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <legend>Dates</legend>
        <div class="panel panel-info">
            <table class="table">
                <tbody>
                <tr>
                    <td><b>Created</b></td>
                    <td>{{ task.creation_date }}</td>
                </tr>
                <tr>
                    <td><b>Updated</b></td>
                    <td>{{ task.modified_date }}</td>
                </tr>
                <tr>
                    <td><b>Completed</b></td>
                    <td>{{ task.completed_date }}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <legend>Links
            <a class="pull-right btn btn-sm btn-success" href="{% url 'task:link_task' task.id %}"><span class="glyphicon glyphicon-link"></span> Add Link</a></legend>
    </div>
    <div class="col-md-6">
        {% if task.links_in.count > 0 %}
        <div class="panel panel-info">
            <table class="table">
            {% for link in task.links_in.all %}
                <tr>
                    <td>{{ link.link_type.from_desc }}</td>
                    <td>#{{ link.from_task.id }}</td>
                    <td>{{ link.from_task.name }}</td>
                </tr>
            {% endfor %}
            </table>
        </div>
        {% else %}
            <p>No incoming...</p>
        {% endif %}
    </div>
    <div class="col-md-6">
        {% if task.links_out.count > 0 %}
        <div class="panel panel-info">
            <table class="table">
            {% for link in task.links_out.all %}
                <tr>
                    <td>{{ link.link_type.to_desc }}</td>
                    <td>#{{ link.to_task.id }}</td>
                    <td>{{ link.to_task.name }}</td>
                </tr>
            {% endfor %}
            </table>
        </div>
        {% else %}
            <p>No outgoing...</p>
        {% endif %}
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <legend>History</legend>
        {% if history %}
            {% for record in history %}
            <div class="panel panel-default">
                <div class="panel-heading">
                    {{ record.user.username }} @ {{ record.timestamp }}
                </div>
                <div class="panel-body">
                    {% for entry in record.get_entry_slugs %}
                        {{ entry }}
                        <br />
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>Nothing of interest...</p>
        {% endif %}
    </div>
</div>
{% endblock %}
